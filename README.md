# ordered online locations service

This django based micro service manages all location (i.e., bars, restaurants, ...) related tasks.

## Technology Stack

- Python 3
- Django

## Quickstart

Make sure, that Python 3 and Django are installed. Run the server.
```
$ cd locations
$ python3 manage.py migrate
$ python3 manage.py runserver 127.0.0.1:8002
```

If you want to prepopulate your database with some examples, run:
```
$ python3 manage.py load_data
```

## API Endpoints

Following API Endpoints are supported:

### Create a location with `/locations/create/`
Create a location.
Method: POST

This endpoint is secured by verification. The preferred location for the verification service to run is at http://127.0.0.1:8000/.
You need to pass the verification session key and the verification user_id. 

|Parameter|Explanation|
|-|-|
|user_id|User id for user verification.|
|session_key|Session key for user verification.|
|location|The location to be created, without an id attribute.|

Example location creation with `curl`:

```
curl -i -X POST -H 'Content-Type: application/json' -d '{
    "session_key": "r2sao9x3embkskiz8wonygnyrkgipwoc",
    "user_id": 1, 
    "location": { 
        "name":"Studentencaf\u00e9 Ascii",
        "description":"Gem\u00fctliches Caf\u00e9 in der Fak. Informatik der TU Dresden.",
        "address":"N\u00f6thnitzer Str. 46, 01187 Dresden",
        "user_id":1,
        "latitude":"51.02508690",
        "longitude":"13.72100050",
        "website":null,
        "telephone":null,
        "categories":[ 
            { 
                "name":"Cafe"
            }
        ],
        "tags":[ 
            { 
                "name":"calm"
            },
            { 
                "name":"inexpensive"
            },
            { 
                "name":"insider"
            }
        ]
    }
}' http://127.0.0.1:8002/locations/create/
```

Of course, it is required, that the user 1 exists in the verification service and the session key is still valid.
Note, that the `id` field is not passed, since it is autogenerated by django.

Example response:

```
{ 
   "success":true
}
```

Failure Responses:
- [IncorrectAccessMethod](#IncorrectAccessMethod) if the service was accessed with any other method than specified.
- [IncorrectCredentials](#IncorrectCredentials) if the passed credentials were incorrect.
- [DuplicateLocation](#DuplicateLocation) if the given location exists by means of all unique constraints.
- [MalformedJson](#MalformedJson) if the given Json was malformed.
- [VerificationServiceUnavailable](#VerificationServiceUnavailable) if the verification service could not be contacted.


### Edit a location with `/locations/edit/<location_id>/`
Edit a location.
Method: POST

This endpoint is secured by verification. The preferred location for the verification service to run is at http://127.0.0.1:8000/.
You need to pass the verification session key and the verification user_id. 

|Parameter|Explanation|
|-|-|
|user_id|User id for user verification.|
|session_key|Session key for user verification.|
|location|The location to be created, without an id attribute.|

Example of editing a location with `curl`:

```
curl -i -X POST -H 'Content-Type: application/json' -d '{
    "session_key": "r2sao9x3embkskiz8wonygnyrkgipwoc",
    "user_id": 1, 
    "location": { 
        "name":"Studentencaf\u00e9 Ascii (Edited)",
        "description":"Gem\u00fctliches Caf\u00e9 in der Fak. Informatik der TU Dresden.",
        "address":"N\u00f6thnitzer Str. 46, 01187 Dresden",
        "user_id":1,
        "latitude":"51.02508690",
        "longitude":"13.72100050",
        "website":null,
        "telephone":null,
        "categories":[ 
            { 
                "name":"Cafe"
            }
        ],
        "tags":[ 
            { 
                "name":"calm"
            },
            { 
                "name":"inexpensive"
            },
            { 
                "name":"insider"
            }
        ]
    }
}' http://127.0.0.1:8002/locations/edit/1/
```

Of course, it is required, that the user 1 exists in the verification service and the session key is still valid.
The location to be edited in this case is available under id 1.
Note, that the `id` field **must not** be passed in json, since it is inferred by the url.

Example response:

```
{ 
   "success":true
}
```

Failure Responses:
- [LocationNotFound](#LocationNotFound) if the location under the given id could not be found. 
- [IncorrectCredentials](#IncorrectCredentials) if the passed credentials were incorrect.
- [IncorrectAccessMethod](#IncorrectAccessMethod) if the service was accessed with any other method than specified.
- [MalformedJson](#MalformedJson) if the given Json was malformed.
- [VerificationServiceUnavailable](#VerificationServiceUnavailable) if the verification service could not be contacted.

### Find a location with`/locations/find/`
Finds a location to the given parameters.
Method: GET

|Parameter|Explanation|
|-|-|
|user_id|Search for locations by a specific user id.|
|name|Search for locations, whose names contain the given query (case insensitive).|
|category|Search for locations with a given category.|
|tag|Search for locations with a given tag.|

At least one of these parameters should be supplied. All parameters can be combined.
Results are limited to 100 locations.

Example name search with `curl`:
```
$ curl -i -X GET http://127.0.0.1:8002/locations/find/?name=asci

{ 
   "success":true,
   "response":[ 
      { 
         "location":{ 
            "id":1,
            "name":"Studentencaf\u00e9 Ascii",
            "description":"Gem\u00fctliches Caf\u00e9 in der Fak. Informatik der TU Dresden.",
            "address":"N\u00f6thnitzer Str. 46, 01187 Dresden",
            "user_id":1,
            "latitude":"51.02508690",
            "longitude":"13.72100050",
            "website":null,
            "telephone":null,
            "categories":[ 
               { 
                  "name":"Cafe"
               }
            ],
            "tags":[ 
               { 
                  "name":"calm"
               },
               { 
                  "name":"inexpensive"
               },
               { 
                  "name":"insider"
               }
            ]
         }
      }
   ]
}
```

Example search for a given tag and a given category with `curl`:
```
$ curl -i -X GET http://127.0.0.1:8002/locations/find/?tag=calm&category=cafe

{ 
   "success":true,
   "response":[ 
      { 
         "location":{          
            "id":1,
            "name":"Studentencaf\u00e9 Ascii",
            "description":"Gem\u00fctliches Caf\u00e9 in der Fak. Informatik der TU Dresden.",
            "address":"N\u00f6thnitzer Str. 46, 01187 Dresden",
            "user_id":1,            
            "latitude":"51.02508690",
            "longitude":"13.72100050",
            "website":null,
            "telephone":null,
            "categories":[ 
               { 
                  "name":"Cafe"
               }
            ],
            "tags":[ 
               { 
                  "name":"calm"
               },
               { 
                  "name":"inexpensive"
               },
               { 
                  "name":"insider"
               }
            ]
         }
      }
   ]
}
```

Failure Responses:
- [IncorrectAccessMethod](#IncorrectAccessMethod) if the service was accessed with any other method than specified.
- [MalformedJson](#MalformedJson) if the passed json does not conform to the given description.
- [IncorrectCredentials](#IncorrectCredentials) if the passed credentials are incorrect.


### Find locations nearby with `/locations/nearby/`
Finds a location nearby.
Method: GET

|Parameter|Explanation|Mandatory|
|-|-|-|
|longitude|The longitude of the position to be searched.|yes|
|latitude|The loatitude of the position to be searched.|yes|
|radius|The radius in meters for results to be fetched.|no (Default is 10000m)|

Let's say you are at Helmholtzstra√üe and want to find locations within 1000m. Example name search with `curl`:
Results are limited to 100 locations.

Note the extra `distance` key which can be used for visual representation of the distance to the location.

```
$ curl -i -X GET http://127.0.0.1:8002/locations/nearby/\?latitude\=51.0282096\&longitude\=13.722814\&radius\=1000

{ 
   "success":true,
   "response":[ 
      { 
         "distance":370.0810107027033,
         "location":{ 
            "id":1,
            "name":"Studentencaf\u00e9 Ascii",
            "description":"Gem\u00fctliches Caf\u00e9 in der Fak. Informatik der TU Dresden.",
            "address":"N\u00f6thnitzer Str. 46, 01187 Dresden",
            "user_id":1,
            "latitude":"51.02508690",
            "longitude":"13.72100050",
            "website":null,
            "telephone":null,
            "categories":[ 
               { 
                  "name":"Cafe"
               }
            ],
            "tags":[ 
               { 
                  "name":"calm"
               },
               { 
                  "name":"inexpensive"
               },
               { 
                  "name":"insider"
               }
            ]
         }
      }
   ]
}
```

Failure Responses:
- [IncorrectAccessMethod](#IncorrectAccessMethod) if the service was accessed with any other method than specified.
- [ErroneousValue](#ErroneousValue) if the given coordinates or the given radius could not be parsed to floats.


### `/locations/get/<location_id>/`
Gets the requested location.
Methods: GET.

Example with `curl`: 

```
$ curl -i -X GET http://127.0.0.1:8002/locations/get/1/

{ 
   "success":true,
   "response":{ 
      "id":1,
      "name":"Studentencaf\u00e9 Ascii",
      "description":"Gem\u00fctliches Caf\u00e9 in der Fak. Informatik der TU Dresden.",
      "address":"N\u00f6thnitzer Str. 46, 01187 Dresden",
      "user_id":1,
      "latitude":"51.02508690",
      "longitude":"13.72100050",
      "website":null,
      "telephone":null,
      "categories":[ 
         { 
            "name":"Cafe"
         }
      ],
      "tags":[ 
         { 
            "name":"calm"
         },
         { 
            "name":"inexpensive"
         },
         { 
            "name":"insider"
         }
      ]
   }
}
```

Failure Responses:
- [IncorrectAccessMethod](#IncorrectAccessMethod) if the service was accessed with any other method than specified.
- [LocationNotFound](#LocationNotFound) if the requested location could not be found.


## Failure Responses

Following failure responses are supported:

### IncorrectCredentials

```
{ 
   "success":false,
   "reason":"incorrect_credentials"
}
```

### MalformedJson

```
{
    "success":false,
    "reason":"malformed_json"
}
```

### DuplicateLocation

```
{
    "success":false,
    "reason":"duplicate_location"
}
```

### VerificationServiceUnavailable

```
{
    "success":false,
    "reason":"verification_service_unavailable"
}
```

### ErroneousValue

```
{ 
   "success":false,
   "reason":"erroneous_value"
}
```

### IncorrectAccessMethod

```
{ 
   "success":false,
   "reason":"incorrect_access_method"
}
```

### LocationNotFound

```
{ 
   "success":false,
   "reason":"location_not_found"
}
```


